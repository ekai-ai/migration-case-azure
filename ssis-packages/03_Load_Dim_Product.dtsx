<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationName="Microsoft.Package"
  DTS:DTSID="{PKG03-DIM-PROD-0001}"
  DTS:ObjectName="03_Load_Dim_Product"
  DTS:PackageType="5">
  <DTS:Property DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager DTS:refId="Package.ConnectionManagers[NorthwindDW]" DTS:CreationName="OLEDB" DTS:DTSID="{CONN-DW-0003}" DTS:ObjectName="NorthwindDW">
      <DTS:ObjectData>
        <DTS:ConnectionManager DTS:ConnectionString="Data Source=localhost;Initial Catalog=Northwind;Provider=MSOLEDBSQL;Integrated Security=SSPI;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables>
    <DTS:Variable DTS:CreationName="" DTS:DTSID="{VAR-PRD-001}" DTS:Namespace="User" DTS:ObjectName="RowsInserted">
      <DTS:VariableValue DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable DTS:CreationName="" DTS:DTSID="{VAR-PRD-002}" DTS:Namespace="User" DTS:ObjectName="BudgetPriceThreshold">
      <DTS:VariableValue DTS:DataType="6">15.00</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable DTS:CreationName="" DTS:DTSID="{VAR-PRD-003}" DTS:Namespace="User" DTS:ObjectName="PremiumPriceThreshold">
      <DTS:VariableValue DTS:DataType="6">50.00</DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable DTS:refId="Package\Log Start" DTS:CreationName="Microsoft.ExecuteSQLTask" DTS:DTSID="{EXEC-LOG-PRD1}" DTS:ExecutableType="Microsoft.ExecuteSQLTask" DTS:ObjectName="Log Start">
      <DTS:ObjectData>
        <SQLTask:SqlTaskData SQLTask:Connection="{CONN-DW-0003}" SQLTask:SqlStatementSource="INSERT INTO dbo.ETL_Log (PackageName, TaskName, StartTime, Status) VALUES ('03_Load_Dim_Product', 'Full Load', GETDATE(), 'Running')" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable DTS:refId="Package\Truncate Dim_Product" DTS:CreationName="Microsoft.ExecuteSQLTask" DTS:DTSID="{EXEC-TRUNC-PRD}" DTS:ExecutableType="Microsoft.ExecuteSQLTask" DTS:ObjectName="Truncate Dim_Product">
      <DTS:ObjectData>
        <SQLTask:SqlTaskData SQLTask:Connection="{CONN-DW-0003}" SQLTask:SqlStatementSource="DELETE FROM dbo.Dim_Product" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable DTS:refId="Package\Load Product Dimension" DTS:CreationName="Microsoft.ExecuteSQLTask" DTS:DTSID="{EXEC-LOAD-PRD}" DTS:ExecutableType="Microsoft.ExecuteSQLTask" DTS:ObjectName="Load Product Dimension" DTS:Description="Load products with derived attributes">
      <DTS:ObjectData>
        <SQLTask:SqlTaskData SQLTask:Connection="{CONN-DW-0003}" SQLTask:SqlStatementSource="
INSERT INTO dbo.Dim_Product (
    ProductID, ProductName, CategoryID, CategoryName, CategoryDescription,
    SupplierID, SupplierName, SupplierCountry, SupplierRegion,
    QuantityPerUnit, UnitPrice, UnitsInStock, UnitsOnOrder, ReorderLevel,
    Discontinued, PriceRange, StockStatus, InventoryValue, EffectiveDate, IsCurrent
)
SELECT
    p.ProductID,
    p.ProductName,
    p.CategoryID,
    c.CategoryName,
    c.Description AS CategoryDescription,
    p.SupplierID,
    s.CompanyName AS SupplierName,
    s.Country AS SupplierCountry,
    s.Region AS SupplierRegion,
    p.QuantityPerUnit,
    p.UnitPrice,
    p.UnitsInStock,
    p.UnitsOnOrder,
    p.ReorderLevel,
    p.Discontinued,
    -- PriceRange derived column
    CASE
        WHEN p.UnitPrice &lt; 15.00 THEN 'Budget'
        WHEN p.UnitPrice >= 50.00 THEN 'Premium'
        ELSE 'Mid-Range'
    END AS PriceRange,
    -- StockStatus derived column
    CASE
        WHEN p.UnitsInStock = 0 THEN 'Out of Stock'
        WHEN p.UnitsInStock &lt;= p.ReorderLevel THEN 'Low Stock'
        ELSE 'In Stock'
    END AS StockStatus,
    -- InventoryValue
    p.UnitPrice * p.UnitsInStock AS InventoryValue,
    CAST(GETDATE() AS DATE) AS EffectiveDate,
    1 AS IsCurrent
FROM Products p
INNER JOIN Categories c ON p.CategoryID = c.CategoryID
INNER JOIN Suppliers s ON p.SupplierID = s.SupplierID;
" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable DTS:refId="Package\Get Row Count" DTS:CreationName="Microsoft.ExecuteSQLTask" DTS:DTSID="{EXEC-CNT-PRD}" DTS:ExecutableType="Microsoft.ExecuteSQLTask" DTS:ObjectName="Get Row Count">
      <DTS:ObjectData>
        <SQLTask:SqlTaskData SQLTask:Connection="{CONN-DW-0003}" SQLTask:SqlStatementSource="SELECT COUNT(*) FROM dbo.Dim_Product" SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding SQLTask:ResultName="0" SQLTask:DtsVariableName="User::RowsInserted" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable DTS:refId="Package\Log Success" DTS:CreationName="Microsoft.ExecuteSQLTask" DTS:DTSID="{EXEC-LOG-PRD2}" DTS:ExecutableType="Microsoft.ExecuteSQLTask" DTS:ObjectName="Log Success">
      <DTS:ObjectData>
        <SQLTask:SqlTaskData SQLTask:Connection="{CONN-DW-0003}" SQLTask:SqlStatementSource="UPDATE dbo.ETL_Log SET EndTime = GETDATE(), Status = 'Succeeded', RowsInserted = ? WHERE PackageName = '03_Load_Dim_Product' AND Status = 'Running'" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding SQLTask:ParameterName="0" SQLTask:DtsVariableName="User::RowsInserted" SQLTask:ParameterDirection="Input" SQLTask:DataType="3" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint DTS:refId="Package.PrecedenceConstraints[Log to Truncate]" DTS:CreationName="" DTS:DTSID="{PC-0003-0001}" DTS:From="Package\Log Start" DTS:LogicalAnd="True" DTS:ObjectName="Log to Truncate" DTS:To="Package\Truncate Dim_Product" />
    <DTS:PrecedenceConstraint DTS:refId="Package.PrecedenceConstraints[Truncate to Load]" DTS:CreationName="" DTS:DTSID="{PC-0003-0002}" DTS:From="Package\Truncate Dim_Product" DTS:LogicalAnd="True" DTS:ObjectName="Truncate to Load" DTS:To="Package\Load Product Dimension" />
    <DTS:PrecedenceConstraint DTS:refId="Package.PrecedenceConstraints[Load to Count]" DTS:CreationName="" DTS:DTSID="{PC-0003-0003}" DTS:From="Package\Load Product Dimension" DTS:LogicalAnd="True" DTS:ObjectName="Load to Count" DTS:To="Package\Get Row Count" />
    <DTS:PrecedenceConstraint DTS:refId="Package.PrecedenceConstraints[Count to Log]" DTS:CreationName="" DTS:DTSID="{PC-0003-0004}" DTS:From="Package\Get Row Count" DTS:LogicalAnd="True" DTS:ObjectName="Count to Log" DTS:To="Package\Log Success" />
  </DTS:PrecedenceConstraints>
</DTS:Executable>
